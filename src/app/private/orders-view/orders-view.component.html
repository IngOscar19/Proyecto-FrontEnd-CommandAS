<div class="orders-page container-fluid p-4">
    
    <div class="header-section mb-4">
        <h1 class="text-primary-blue fw-bold m-0">Gestión de Órdenes</h1>
        <p class="text-muted m-0">Administra el estado y seguimiento de tus pedidos</p>
    </div>

    <mat-tab-group fitInkBarToContent animationDuration="300ms" class="custom-tabs">
        @for (eachStatus of status; track $index) {
        <mat-tab>
            <ng-template mat-tab-label>
                <div class="d-flex align-items-center">
                    <span class="tab-label">{{eachStatus.name}}</span>
                    <span class="badge ms-2 rounded-pill" 
                          [ngClass]="{'bg-orange': filterByStatus(eachStatus.value).length > 0, 'bg-secondary': filterByStatus(eachStatus.value).length === 0}">
                        {{ filterByStatus(eachStatus.value).length }}
                    </span>
                </div>
            </ng-template>

            <section class="table-wrapper mt-4">
                
                <div class="mat-elevation-z4 rounded-3 overflow-hidden bg-white">
                    <table mat-table [dataSource]="filterByStatus(eachStatus.value)" class="w-100 modern-table">
                        
                        <ng-container matColumnDef="client">
                            <th mat-header-cell *matHeaderCellDef> Cliente </th>
                            <td mat-cell *matCellDef="let element"> 
                                <div class="d-flex align-items-center py-2">
                                    <div class="avatar-circle me-3">{{ element.client?.charAt(0).toUpperCase() || '?' }}</div>
                                    <div class="d-flex flex-column">
                                        <span class="fw-bold text-dark">{{element.client}}</span>
                                        <span class="small text-muted">Orden #{{element.idorder | slice:0:6}}</span>
                                    </div>
                                </div>
                            </td>
                        </ng-container>

                        <ng-container matColumnDef="total">
                            <th mat-header-cell *matHeaderCellDef> Total </th>
                            <td mat-cell *matCellDef="let element" class="text-orange fw-bold">
                                {{element.total | currency}}
                            </td>
                        </ng-container>

                        <ng-container matColumnDef="comments">
                            <th mat-header-cell *matHeaderCellDef> Comentarios </th>
                            <td mat-cell *matCellDef="let element">
                                <div class="comments-cell">
                                    <span *ngIf="element.comments" class="general-comment text-dark">
                                        <mat-icon class="tiny-icon">comment</mat-icon> {{ element.comments }}
                                    </span>
                                    
                                    <span *ngIf="!element.comments" class="text-muted fst-italic small">
                                        ---
                                    </span>
                                    
                                    <div *ngIf="hasProductNotes(element)" class="product-notes-alert mt-1">
                                        <span class="badge bg-info text-dark rounded-1">
                                            <mat-icon class="tiny-icon">restaurant</mat-icon> Ver notas en platillos
                                        </span>
                                    </div>
                                </div>
                            </td>
                        </ng-container>

                        <ng-container matColumnDef="function">
                            <th mat-header-cell *matHeaderCellDef class="text-center"> Acciones </th>
                            <td mat-cell *matCellDef="let element" class="text-center">
                                <div class="action-buttons d-flex justify-content-center gap-1">
                                    
                                    <button mat-icon-button 
                                            class="btn-icon-blue" 
                                            matTooltip="Ver Detalles Completa"
                                            (click)="openOrderDetailDialog(element)">
                                        <mat-icon>visibility</mat-icon>
                                    </button>

                                    @if (eachStatus.value == 0) {
                                        <button mat-icon-button 
                                                class="btn-icon-warn" 
                                                matTooltip="Cancelar Orden"
                                                (click)="openCancelDialog(element)">
                                            <mat-icon>block</mat-icon>
                                        </button>
                                    }

                                    @if (eachStatus.value == 2) {
                                        <button mat-icon-button 
                                                class="btn-icon-success" 
                                                matTooltip="Entregar / Completar"
                                                (click)="openConfirmDialog(element)">
                                            <mat-icon>check_circle</mat-icon>
                                        </button>
                                    }
                                </div>
                            </td>
                        </ng-container>

                        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                        <tr mat-row *matRowDef="let row; columns: displayedColumns;" class="element-row"></tr>
                        
                        <tr class="mat-row" *matNoDataRow>
                            <td class="mat-cell text-center py-5" [attr.colspan]="displayedColumns.length">
                                <div class="d-flex flex-column align-items-center opacity-50">
                                    <mat-icon style="font-size: 48px; width: 48px; height: 48px;">inbox</mat-icon>
                                    <p class="mt-2 mb-0">No hay órdenes en estado: <strong>{{eachStatus.name}}</strong></p>
                                </div>
                            </td>
                        </tr>

                    </table>
                </div>
            </section>
        </mat-tab>
        }
    </mat-tab-group>
</div>