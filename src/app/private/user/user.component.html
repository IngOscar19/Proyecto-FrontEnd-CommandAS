<div class="user-page container py-5">
    <div class="row justify-content-center">
        <div class="col-12 col-md-10 col-lg-8">
            
            <div class="card user-card border-0 shadow-lg">
                
                <div class="card-header bg-white border-0 pt-4 px-4 pb-0 d-flex justify-content-between align-items-center">
                    <div>
                        <h2 class="text-primary-blue fw-bold m-0 d-flex align-items-center">
                            @if(id) {
                                <mat-icon class="icon-header me-2">edit</mat-icon>Editar Usuario
                            } @else {
                                <mat-icon class="icon-header me-2">person_add</mat-icon>Nuevo Usuario
                            }
                        </h2>
                        <p class="text-muted small mt-1 mb-0">Gestión de credenciales y roles</p>
                    </div>
                    <button mat-icon-button [routerLink]="['/private/user-view']" matTooltip="Volver a la lista" class="text-muted">
                        <mat-icon>arrow_back</mat-icon>
                    </button>
                </div>

                <div class="card-body p-4 pt-3">
                    <form [formGroup]="formulario" (ngSubmit)="save()" class="d-flex flex-column gap-3">
                        
                        <div class="row g-3">
                            <div class="col-12">
                                <mat-form-field appearance="outline" class="w-100 custom-field">
                                    <mat-label>Nombre completo</mat-label>
                                    <mat-icon matPrefix class="icon-orange">person</mat-icon>
                                    <input type="text" matInput formControlName="name" placeholder="Ej: Maria Gonzalez">
                                    <mat-error>El nombre es requerido</mat-error>
                                </mat-form-field>
                            </div>

                            <div class="col-12 col-md-6">
                                <mat-form-field appearance="outline" class="w-100 custom-field">
                                    <mat-label>Rol asignado</mat-label>
                                    <mat-icon matPrefix class="icon-orange">badge</mat-icon>
                                    <mat-select formControlName="rol">
                                        @for (rol of roles; track $index) {
                                            <mat-option [value]="rol.value">
                                                {{rol.name}}
                                            </mat-option>
                                        }
                                    </mat-select>
                                    <mat-error>Selecciona un rol</mat-error>
                                </mat-form-field>
                            </div>

                            <div class="col-12 col-md-6">
                                <mat-form-field appearance="outline" class="w-100 custom-field">
                                    <mat-label>Teléfono</mat-label>
                                    <mat-icon matPrefix class="icon-orange">phone</mat-icon>
                                    <input type="tel" matInput formControlName="phone" placeholder="10 dígitos">
                                    <mat-error>Formato inválido</mat-error>
                                </mat-form-field>
                            </div>

                            <div class="col-12">
                                <mat-form-field appearance="outline" class="w-100 custom-field">
                                    <mat-label>Contraseña</mat-label>
                                    <mat-icon matPrefix class="icon-orange">lock</mat-icon>
                                    <input [type]="hidePassword ? 'password' : 'text'" matInput formControlName="password" placeholder="******">
                                    
                                    <button mat-icon-button matSuffix type="button" (click)="hidePassword = !hidePassword" [attr.aria-label]="'Ocultar contraseña'">
                                        <mat-icon class="text-muted">{{hidePassword ? 'visibility_off' : 'visibility'}}</mat-icon>
                                    </button>
                                    
                                    <mat-error>Contraseña requerida</mat-error>
                                    @if(id) {
                                        <mat-hint class="text-info-dark small">
                                            <mat-icon style="font-size: 12px; height: 12px; width: 12px; margin-right: 4px; vertical-align: middle;">info</mat-icon>
                                            Dejar en blanco para conservar la actual
                                        </mat-hint>
                                    }
                                </mat-form-field>
                            </div>
                        </div>

                        <div class="d-flex justify-content-end gap-3 mt-4 action-buttons">
    
                            @if (id) {
                                <button type="button" mat-stroked-button class="btn-delete" (click)="deleteUser()" [disabled]="isLoading">
                                    <mat-icon>delete</mat-icon>
                                    <span>Eliminar</span>
                                </button>
                            }

                            <button type="submit" mat-button class="btn-save" [disabled]="formulario.invalid || isLoading">
                                @if (isLoading) {
                                    <mat-spinner diameter="20" class="spinner-white"></mat-spinner>
                                } @else {
                                    <span>{{ id ? 'ACTUALIZAR USUARIO' : 'GUARDAR USUARIO' }}</span>
                                }
                            </button>
                        </div>      

                    </form>
                </div>
            </div>

        </div>
    </div>
</div>