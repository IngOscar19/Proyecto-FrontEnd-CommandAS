<div class="users-page container-fluid p-4">
  
  <div class="row align-items-center mb-4 g-3">
    <div class="col-12 col-md-4">
      <h1 class="text-primary-blue fw-bold m-0 d-flex align-items-center">
        <mat-icon class="me-2 icon-title">group</mat-icon>
        Usuarios
      </h1>
      <p class="text-muted small m-0 ms-4 ps-2">Gestión del personal y clientes</p>
    </div>

    <div class="col-12 col-md-8 d-flex gap-3 justify-content-md-end flex-wrap">
      
      <mat-form-field appearance="outline" class="search-field dense-field">
        <mat-icon matPrefix class="text-muted">search</mat-icon>
        <mat-label>Buscar...</mat-label>
        <input matInput (keyup)="applyFilter($event)" placeholder="Nombre, teléfono..." #input>
      </mat-form-field>

      <button mat-flat-button class="btn-new shadow-sm" [routerLink]="'/private/user-create'">
        <mat-icon>add</mat-icon>
        <span>Nuevo Usuario</span>
      </button>

    </div>
  </div>
  
  <div class="table-container mat-elevation-z4 rounded-3 overflow-hidden bg-white">
    <table mat-table [dataSource]="dataSource" matSort class="w-100 modern-table">
      
      <ng-container matColumnDef="name">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> Nombre </th>
        <td mat-cell *matCellDef="let row"> 
          <div class="d-flex align-items-center py-2">
            <div class="avatar-circle me-3">{{ row.name.charAt(0).toUpperCase() }}</div>
            <div class="d-flex flex-column">
              <span class="fw-bold text-dark">{{row.name}}</span>
              @if(row.rol == 3) { <span class="small text-muted">ID: {{row.idusers | slice:0:6}}...</span> }
            </div>
          </div>
        </td>
      </ng-container>

      <ng-container matColumnDef="phone">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> Teléfono </th>
        <td mat-cell *matCellDef="let row" class="text-muted"> 
          <mat-icon class="align-middle fs-6 me-1" style="font-size:16px; width:16px; height:16px;">phone</mat-icon>
          {{row.phone || 'Sin registro'}} 
        </td>
      </ng-container>

      <ng-container matColumnDef="rol">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> Rol </th>
        <td mat-cell *matCellDef="let row">
          <span class="role-badge" [ngClass]="'role-' + row.rol">
            {{ mapRol(row.rol) }}
          </span>
        </td>
      </ng-container>

      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef class="text-end pe-4"> Acciones </th>
        <td mat-cell *matCellDef="let row" class="text-end pe-3">
          
          <div class="action-buttons d-flex justify-content-end gap-1">
            @if (row.rol != 3) {
              <button mat-icon-button class="btn-icon-edit" [routerLink]="['/private/user-edit', row.idusers]" matTooltip="Editar">
                <mat-icon>edit</mat-icon>
              </button>

              <button mat-icon-button class="btn-icon-delete" (click)="deleteUser(row.idusers)" matTooltip="Eliminar">
                <mat-icon>delete_outline</mat-icon>
              </button>
            } @else {
              <button mat-icon-button disabled matTooltip="Usuario registrado desde la App">
                <mat-icon class="text-muted opacity-50">smartphone</mat-icon>
              </button>
            }
          </div>

        </td>
      </ng-container>
      
      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;" class="element-row"></tr>
  
      <tr class="mat-row" *matNoDataRow>
        <td class="mat-cell p-5 text-center text-muted" colspan="4">
          <div class="d-flex flex-column align-items-center opacity-75">
            <mat-icon style="font-size: 48px; width: 48px; height: 48px;" class="mb-2 text-primary-blue">search_off</mat-icon>
            <p class="mb-0 fw-medium">No encontramos a "{{input.value}}"</p>
          </div>
        </td>
      </tr>
    </table>
  
    <mat-paginator [pageSizeOptions]="[5, 10, 25]" showFirstLastButtons class="border-top"></mat-paginator>
  </div>
</div>